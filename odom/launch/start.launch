<launch>
    <!-- <arg name="port" default="/dev/ttyUSB1"/>
    <arg name="baud" default="9600"/>
    <arg name="useRMC" default="True"/> -->

    <!-- Start IMU communication -->
    <!-- <node pkg="um7" name="imu" type="um7_driver" args="_port:=/dev/ttyUSB0"/> -->

    <!-- Start Groove GPS communication -->
    <!-- <include file="$(find nmea_navsat_driver)/launch/nmea_serial_driver.launch">
        <arg name="port" value="$(arg port)"/>
        <arg name="baud" value="$(arg baud)"/>
        <arg name="useRMC" value="$(arg useRMC)"/>
    </include> -->

    <!-- Enable robot visualization in rviz -->
    <param name="robot_description" command="xacro --inorder '$(find odom)/config/robot.xacro'" />

    <node pkg="tf2_ros" type="static_transform_publisher" name="bl_to_imu" args="0 0 0 0 0 0 1 base_link imu_link" />
    <node pkg="tf2_ros" type="static_transform_publisher" name="bl_to_gps" args="0 0 0 0 0 0 1 base_link gps" />

    <!-- Start map server -->
    <arg name="map_file" default="$(find odom)/maps/map_config.yaml" />
    <node name="map_server" pkg="map_server" type="map_server" args="$(arg map_file)" />

    <node pkg="odom" name="convert" type="convert.py" output="screen" />

    <node pkg="robot_localization" type="ekf_localization_node" name="ekf_localization_global">
        <rosparam command="load" file="($find odom)/config/ekf_global.yaml" />
        <remap from="/odometry/filtered" to="/odometry/filtered/global" />
    </node>

    <!-- Run the GPS conversion node -->
    <node pkg="robot_localization" type="navsat_transform_node" name="navsat_transform_node" respawn="true">
        <param name="frequency" value="1"/>
        <param name="yaw_offset" value="1.5707963"/>
        <param name="zero_altitude" value="true"/>
        <param name="wait_for_datum" value="false"/>
        <param name="publish_filtered_gps" value="true"/>
        
        <remap from="/imu/data" to="/imu/data" />
        <remap from="/gps/fix" to="/gps/fix" />
        <remap from="/odometry/filtered" to="/odometry/filtered/global" />
    </node>


    <!-- Start the rosbag -->
    <node pkg="rosbag" type="play" name="player" output="screen" args="/home/kai/Desktop/bags/recording_2022-04-01-02-52-27.bag"/>

    <!-- Start rviz -->
    <node pkg="rviz" name="rviz" type="rviz" args="-d $(find odom)/rviz/config.rviz" />

</launch>
